@model Model.Pots
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section head{
    <link href="~/Content/amazeui.min.css" rel="stylesheet" />
    <style>
        .PotsMain {
            width: 100%;
            height: auto;
            margin: 100px auto;
        }

            .PotsMain .Pots {
                width: 30%;
                height: auto;
                margin: 20% auto;
                text-align: center;
            }

                .PotsMain .Pots img {
                    width: 50%;
                    height: 50%;
                }

                .PotsMain .Pots .PotsSign {
                    width: 50%;
                    height: auto;
                    margin: 10px auto;
                }
                .Pots .SignTip{
                    float:left;
                    width:60%;
                    height:200px;
                    margin:-75% 20%;
                    position:relative;
                    background:url('../../images/签到成功.png') no-repeat;
                    background-size:120%;
                    background-position:center;
                    display:none;
                }
                .Pots .SignTip p{
                    position:absolute;
                    text-align:center;
                    top:35%;
                    left:22%;
                }
    </style>
}
<div class="PotsMain">
    <div class="Pots">
        <img src="~/images/虚拟多肉.png" />
        <div class="PotsSign">
            @{
                if (Model == null)
                {
                    using (Html.BeginForm("InsertPots", "Pots", FormMethod.Post))
                    {
                        <button class="am-btn am-btn-success am-btn-block">开通多肉</button>
                        <div class="am-progress">
                            <div class="am-progress-bar" style="width: 40%"></div>
                        </div>
                    }
                }
                else
                {
                    //using (Html.BeginForm("Sign", "Pots", FormMethod.Post))
                    //
                    <div class="am-progress">
                    @{ 
                        double progress = (double.Parse((Model.Experience-Model.Level.Levellowerlimit).ToString()) / double.Parse((Model.Level.LevelToplimit - Model.Level.Levellowerlimit).ToString())) * 100;}
                        <div class="am-progress-bar am-progress-bar-danger" style="width:@progress%">2级</div>
                    </div>
                        <p>已连续签到：<b class="dayscount">@Model.SignDays</b> 天</p>
                       <button class="am-btn am-btn-success am-btn-block sign-btn">签到</button>
                    //}
                }
             }
        </div>
        <div class="SignTip">
            <p>@DateTime.Now.ToString("yyyy年MM月dd日")</p>
        </div>
    </div>
</div>
@section Foot{
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script>
        $(function () {
            @{
                string oldsign;
                if (string.IsNullOrEmpty(Model.Sign.ToString()))
                {
                    oldsign = "2000-01-01";
                }
                else
                {
                    oldsign = DateTime.Parse(Model.Sign.ToString()).ToString("yyyy-MM-dd");
                }

                string now = DateTime.Now.ToString("yyyy-MM-dd");
            }
            var old='@oldsign';
            var nowtime = '@now';
            if(old==nowtime){
                $('.sign-btn').attr('disabled', true).text('今日已签到');
            }

            $('.sign-btn').click(function () {
                $.ajax({
                    url:'@Url.Action("Sign", "Pots")',
                    type: 'POST',
                    date: {},
                    success: function (msg) {
                        if (msg == '签到成功！') {
                            $('.SignTip').fadeIn(200).fadeOut(5000);
                            var days=@Model.SignDays==null?0:@Model.SignDays;
                            $('.dayscount').text(days+1);
                            $('.sign-btn').attr('disabled', true).text('今日已签到');
                        } else {
                            return false;
                        }
                    }
                });
            });
        });
    </script>
}
